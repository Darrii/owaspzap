# ğŸ”— Vulnerability Chain Detection for OWASP ZAP

**Graph-based Vulnerability Chain Analysis for Compound Exploit Detection in Web Applications**

## ğŸ“‹ Overview

This system implements an innovative graph-based approach to detect **vulnerability chains** in OWASP ZAP scan results. Unlike traditional scanners that report isolated vulnerabilities, this tool identifies how multiple vulnerabilities can be chained together to create compound exploits with significantly higher impact.

### Scientific Innovation

**Research Title:** *"Graph-based Vulnerability Chain Analysis for Compound Exploit Detection in Web Applications"*

**Key Innovation:** Automatic detection of exploit chains using graph theory and rule-based linking of vulnerabilities, enabling prioritization based on combined risk rather than individual vulnerability severity.

---

## ğŸ¯ Key Features

- **ğŸ•¸ï¸ Graph-Based Analysis**: Constructs directed graphs of vulnerabilities and their relationships
- **ğŸ”— Chain Detection**: Automatically finds exploit paths between vulnerabilities
- **ğŸ“Š Risk Scoring**: Advanced scoring system combining multiple factors:
  - Base severity of vulnerabilities
  - Chain length and complexity
  - Exploitability metrics
  - Potential impact assessment
- **ğŸ“ 15 Pre-defined Chain Rules**: Including:
  - XSS â†’ CSRF Bypass
  - SQL Injection â†’ Privilege Escalation
  - File Upload â†’ Remote Code Execution
  - XXE â†’ SSRF
  - And many more...
- **ğŸ“ˆ Beautiful HTML Reports**: Interactive reports with statistics and visualization
- **ğŸ” CVSS Integration**: Approximate CVSS v3 base scores for chains
- **âš¡ Fast Processing**: Efficient graph algorithms with NetworkX

---

## ğŸš€ Quick Start

### Installation

```bash
# Install dependencies
pip install -r requirements.txt
```

### Basic Usage

```python
from vulnerability_chains import VulnerabilityChainAnalyzer

# Create analyzer
analyzer = VulnerabilityChainAnalyzer()

# Analyze ZAP report
result = analyzer.analyze_zap_report('zap_report.json')

# Generate HTML report
analyzer.generate_report(result, 'chain_report.html')

# Print summary
analyzer.print_summary(result)
```

### Using the Convenience Function

```python
from vulnerability_chains import analyze_zap_scan

# One-line analysis and report generation
result = analyze_zap_scan('zap_report.json')
```

---

## ğŸ“– Detailed Usage

### 1. Analyzing ZAP Reports with Custom Parameters

```python
analyzer = VulnerabilityChainAnalyzer()

result = analyzer.analyze_zap_report(
    report_file='zap_scan.json',
    max_chain_length=5,          # Maximum chain length
    min_confidence=0.7,          # Minimum confidence threshold
    min_risk_filter='Medium'     # Filter low-risk vulnerabilities
)
```

### 2. Working with Vulnerabilities Directly

```python
from vulnerability_chains import Vulnerability, RiskLevel

# Create vulnerabilities
vulns = [
    Vulnerability(
        id="v1",
        name="Cross Site Scripting",
        risk=RiskLevel.HIGH,
        confidence="High",
        url="http://example.com/search",
        param="q"
    ),
    Vulnerability(
        id="v2",
        name="Anti-CSRF Tokens Check",
        risk=RiskLevel.MEDIUM,
        confidence="Medium",
        url="http://example.com/admin"
    )
]

# Analyze
result = analyzer.analyze_vulnerabilities(vulns)
```

### 3. Exporting Results

```python
# Export to multiple formats
files = analyzer.export_results(
    result,
    output_dir='reports',
    formats=['html', 'json']
)

# Export HTML only
html_file = analyzer.generate_report(result, 'report.html')

# Export JSON only
json_file = analyzer.generate_report(result, 'report.json', format='json')
```

### 4. Getting Statistics

```python
# Get comprehensive statistics
stats = analyzer.get_statistics(result)

print(f"Total chains: {stats['detection']['total_chains']}")
print(f"Critical chains: {stats['detection']['critical_chains']}")
print(f"Average risk: {stats['scoring']['average_risk']:.2f}")
print(f"Graph density: {stats['graph']['density']:.3f}")
```

### 5. Filtering and Sorting Chains

```python
# Get top 10 chains
top_chains = analyzer.get_top_chains(result, n=10, min_risk=10.0)

# Get chains by type
from vulnerability_chains import ChainType
rce_chains = result.get_chains_by_type(ChainType.REMOTE_CODE_EXECUTION)

# Get chains by risk threshold
critical_chains = result.get_chains_by_risk(min_risk=15.0)
```

### 6. Custom Chain Rules

Create a custom rules file following this format:

```json
{
  "version": "1.0.0",
  "rules": [
    {
      "rule_id": "CUSTOM_RULE_1",
      "name": "Custom Chain",
      "source_type": "Vulnerability Type A",
      "target_type": "Vulnerability Type B",
      "chain_type": "compound_exploit",
      "conditions": {
        "same_domain": true,
        "min_confidence": 0.7
      },
      "exploitability": 0.8,
      "impact_multiplier": 2.5,
      "description": "Description of the chain",
      "exploitation_steps": [
        "Step 1",
        "Step 2"
      ]
    }
  ]
}
```

Load custom rules:

```python
analyzer = VulnerabilityChainAnalyzer(rules_file='custom_rules.json')
```

---

## ğŸ—ï¸ Architecture

### Core Components

```
vulnerability_chains/
â”œâ”€â”€ __init__.py                 # Main package interface
â”œâ”€â”€ analyzer.py                 # VulnerabilityChainAnalyzer (main class)
â”œâ”€â”€ models.py                   # Data models (Vulnerability, Chain, etc.)
â”œâ”€â”€ constants.py                # Enums and constants
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ vulnerability_graph.py  # Graph structure using NetworkX
â”‚   â”œâ”€â”€ chain_detector.py       # Chain detection algorithms
â”‚   â””â”€â”€ chain_scoring.py        # Risk scoring system
â”œâ”€â”€ rules/
â”‚   â””â”€â”€ chain_rules.py          # Rule engine for linking vulnerabilities
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ zap_parser.py           # ZAP report parser
â”œâ”€â”€ visualization/
â”‚   â””â”€â”€ graph_visualizer.py     # HTML report generator
â””â”€â”€ config/
    â””â”€â”€ chain_rules.json        # Default chain rules (15 rules)
```

### Data Flow

```
ZAP Report â†’ Parser â†’ Vulnerabilities â†’ Graph Builder â†’ Chain Detector â†’ Scorer â†’ Report
```

---

## ğŸ“Š Chain Rules

The system includes 15 pre-defined chain rules:

| Rule | Source â†’ Target | Chain Type | Impact |
|------|----------------|------------|--------|
| XSS_TO_CSRF | XSS â†’ CSRF | Authentication Bypass | 2.5x |
| INFO_DISCLOSURE_TO_AUTH_BYPASS | Info Disclosure â†’ Auth Bypass | Authentication Bypass | 3.0x |
| PATH_TRAVERSAL_TO_CODE_DISCLOSURE | Path Traversal â†’ Source Code | Information Gathering | 2.0x |
| SQL_INJECTION_TO_PRIVILEGE_ESCALATION | SQL Injection â†’ Privilege Escalation | Privilege Escalation | 4.0x |
| XSS_TO_SESSION_HIJACKING | XSS â†’ Session Fixation | Session Hijacking | 3.5x |
| FILE_UPLOAD_TO_RCE | File Upload â†’ Command Injection | Remote Code Execution | 4.5x |
| SSRF_TO_INTERNAL_NETWORK | SSRF â†’ Security Misconfiguration | RCE | 3.8x |
| XXE_TO_SSRF | XXE â†’ SSRF | Data Exfiltration | 3.2x |
| INSECURE_DESERIALIZATION_TO_RCE | Insecure Deserialization â†’ Command Injection | RCE | 4.2x |
| COMMAND_INJECTION_TO_DATA_EXFIL | Command Injection â†’ Info Disclosure | Data Exfiltration | 4.0x |
| ... | ... | ... | ... |

Each rule defines:
- **Source and target vulnerability types**
- **Conditions** (same domain, credentials present, etc.)
- **Exploitability score** (0-1)
- **Impact multiplier** (1-5)
- **Exploitation steps** (detailed attack path)

---

## ğŸ“ˆ Risk Scoring

The risk scoring system combines multiple factors:

```python
risk_score = (
    base_severity Ã— W1 +
    chain_length_score Ã— W2 +
    exploitability_score Ã— W3 +
    impact_score Ã— W4 +
    confidence_score Ã— W5
) Ã— chain_type_multiplier
```

**Risk Categories:**
- **Critical**: â‰¥ 15.0
- **High**: 10.0 - 14.9
- **Medium**: 5.0 - 9.9
- **Low**: < 5.0

---

## ğŸ¨ HTML Report Features

The generated HTML reports include:

- **ğŸ“Š Summary Statistics**: Total vulnerabilities, chains, critical/high counts
- **ğŸ” Top Chains**: Top 10 chains by risk score with full details
- **ğŸ“‹ Complete Chain List**: Sortable table of all detected chains
- **ğŸ’¡ Exploitation Steps**: Step-by-step exploitation guidance for each chain
- **ğŸ¯ Risk Visualization**: Color-coded risk levels
- **ğŸ“± Responsive Design**: Works on desktop and mobile

---

## ğŸ”¬ Research Applications

This system is designed for:

1. **Security Research**: Identifying novel attack paths in web applications
2. **Penetration Testing**: Prioritizing vulnerabilities based on chained impact
3. **Academic Publications**: Reproducible methodology for vulnerability chain analysis
4. **Red Team Exercises**: Discovering compound exploits
5. **Security Training**: Understanding how vulnerabilities combine

### Datasets for Testing

Recommended test targets:
- **OWASP WebGoat**: 50+ known vulnerability chains
- **DVWA (Damn Vulnerable Web Application)**: 30+ chains
- **OWASP Juice Shop**: 40+ chains
- **Real-world applications** (with permission)

---

## ğŸ“Š Example Output

```
======================================================================
ğŸ”— VULNERABILITY CHAIN DETECTION SUMMARY
======================================================================

ğŸ“Š Statistics:
   Total Vulnerabilities: 45
   Total Chains Detected: 12
   Critical Chains: 3
   High Risk Chains: 5
   Analysis Time: 2.34s

ğŸ” Top 5 Chains by Risk:

   1. [REMOTE_CODE_EXECUTION] File Upload Vulnerability â†’ Command Injection (Risk: 22.5)
      Confidence: 88%
      Max Risk: HIGH

   2. [PRIVILEGE_ESCALATION] SQL Injection â†’ Privilege Escalation (Risk: 19.2)
      Confidence: 92%
      Max Risk: HIGH

   3. [SESSION_HIJACKING] Cross Site Scripting â†’ Session Fixation (Risk: 16.8)
      Confidence: 85%
      Max Risk: HIGH
```

---

## ğŸ§ª Testing

Run the examples:

```bash
cd examples
python chain_detection_example.py
```

---

## ğŸ“š Citation

If you use this system in your research, please cite:

```bibtex
@software{vulnerability_chain_detection,
  title = {Graph-based Vulnerability Chain Analysis for Compound Exploit Detection},
  author = {SIAAS Research Team},
  year = {2025},
  version = {1.0.0}
}
```

---

## ğŸ“„ License

MIT License - See LICENSE file for details

---

## ğŸ‘¥ Authors

**SIAAS Research Team**
- Vulnerability Chain Detection System
- Graph-based Security Analysis

---

## ğŸ¤ Contributing

Contributions are welcome! Areas for improvement:

1. Additional chain rules
2. Machine learning-based rule discovery
3. Interactive graph visualization
4. Integration with other security tools
5. Performance optimizations

---

## ğŸ“ Support

For questions or issues:
1. Check the examples in `examples/`
2. Review the API documentation
3. Open an issue on GitHub

---

## ğŸ¯ Roadmap

- [ ] Interactive graph visualization with D3.js
- [ ] Machine learning for automatic rule discovery
- [ ] Integration with Burp Suite
- [ ] Real-time scanning mode
- [ ] API endpoint for integration
- [ ] Docker container for easy deployment

---

**Built with â¤ï¸ for the security research community**
