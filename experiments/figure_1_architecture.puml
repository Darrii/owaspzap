@startuml figure_1_architecture
!theme plain
skinparam backgroundColor transparent
skinparam shadowing false
skinparam defaultFontName Arial
skinparam defaultFontSize 16
skinparam rectangleFontSize 16
skinparam rectangleFontStyle bold
skinparam ArrowThickness 3
skinparam ArrowColor #4A90D9

title <size:22><b>System Architecture: Vulnerability Chain Detection Pipeline</b></size>

rectangle "Web Application\nUnder Test" as webapp #ECF0F1 {
}

note right of webapp
  <b>Target:</b> Any web application
  <b>Example:</b> testphp.vulnweb.com
end note

rectangle "OWASP ZAP Scanner" as zap #4A90D9 {
  rectangle "Spider\n(Crawl pages)" as spider #7FB3E0
  rectangle "Active Scan\n(Inject payloads)" as active #7FB3E0
}

note right of zap
  <b>Config:</b>
  - Port: 8090
  - API Key: changeme
  - Max Depth: 5
  - Timeout: 28800s
end note

rectangle "JSON Parser\n(ZAPAlertParser)" as parser #4A90D9

note right of parser
  <b>Input:</b> ZAP JSON Report
  <b>Output:</b> Vulnerability[]
  <b>Dedup:</b> By alert signature
end note

rectangle "Graph Builder\n(NetworkX DiGraph)" as graph #4A90D9

note right of graph
  <b>Structure:</b>
  - Nodes: Vulnerabilities
  - Edges: Probabilistic rules
  - Type: Directed Graph
end note

rectangle "Rule Engine\n(53 Probabilistic Rules + Config)" as rules #4A90D9

note right of rules
  <b>RuleEngineConfig:</b>
  - min_link_probability: 0.3
  - max_boost_multiplier: 2.5
  - semantic_similarity: True
  - taxonomy_matching: True
  <b>Example Rules:</b>
  - XSS → CSRF (p=0.85)
  - SQLi → PrivEsc (p=0.90)
  - Info → Auth Bypass (p=0.80)
  <b>Total:</b> 53 rules
  <b>Optimizations:</b>
  - Precompiled regex (10-100× speedup)
  - Taxonomy caching (1291× speedup)
  - Bounded boosting (cap 2.5×)
end note

rectangle "DFS Chain Detector\nmax_depth=4, min_prob=0.65" as dfs #4A90D9

note right of dfs
  <b>Parameters:</b>
  - min_length: 2
  - max_length: 4
  - min_chain_prob: 0.65
  - max_chains_per_node: 500
  - max_unique_patterns: 100
end note

rectangle "Smart Filter" as filter #4A90D9 {
  rectangle "Deduplicator\n(Hash-based)" as dedup #7FB3E0
  rectangle "Subchain\nRemoval" as subchain #7FB3E0
}

note right of filter
  <b>Deduplication:</b>
  - Signature: tuple(vuln names)
  - Keep highest risk score
  <b>Subchain Removal:</b>
  - If A→B→C exists,
    remove A→B and B→C
end note

rectangle "Risk Score\nCalculator" as risk #4A90D9

note right of risk
  <b>Component-based Formula (0-100):</b>
  - Base Severity (30%)
  - Exploitability (30%)
  - Chain Length (20%, logarithmic)
  - Confidence (20%)
  <b>Severity Classes:</b>
  CRITICAL (90-100), HIGH (70-89),
  MEDIUM (40-69), LOW (0-39)
end note

rectangle "Report Generator" as report #27AE60 {
  rectangle "HTML\nDashboard" as html #229954
  rectangle "JSON\nExport" as json #229954
}

note right of report
  <b>Outputs:</b>
  - HTML: Interactive graph
  - JSON: Raw chain data
  <b>Final Result:</b> 44 chains
end note

' Vertical flow with labels
webapp -down-> zap : <b>Scan</b>
zap -down-> parser : <b>JSON Report\n(129 alerts)
parser -down-> graph : <b>Vulnerabilities\n(classified)
graph -down-> rules : <b>Graph\n(74 nodes)
rules -down-> dfs : <b>Edges + P\n(5,325 edges)
dfs -down-> filter : <b>Raw Chains\n(~37,000)
filter -down-> risk : <b>Filtered Chains\n(55 unique)
risk -down-> report : <b>Scored Chains\n(44 final)

legend bottom
  <b>Performance Metrics:</b>
  Input: 129 vulnerabilities → Output: 44 chains
  Graph: 74 nodes, 5,325 edges
  Reduction: 37,000 raw → 55 unique → 44 final
  Total time: 0.4 seconds
endlegend

@enduml
